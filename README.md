# Travel App

A web app for travel planning with **Triangle Travel** (find stopover cities), **AI Chat** (ask travel questions), and **My Flights** (track booked flights). Built with **Go** (Gin), **Svelte**, and **SQLite**.

## Features

- **Triangle Travel** – Find a third city to explore on your round-trip itinerary (drive/train then fly, or fly then fly)
  - Same-city detection (e.g. LGA ↔ EWR rejected; both are NYC)
  - Alliance and airline filters for Kayak deep links
- **AI Chat** – Ask travel-related questions (placeholder; integrate OpenAI/Anthropic for full AI)
- **My Flights** – Add and view your booked flights (login required via OTP with US phone number)
- **Error pages** – Dedicated 404 and 500 pages

## Tech Stack

- **Backend**: Go, [Gin](https://github.com/gin-gonic/gin)
- **Frontend**: [Svelte](https://svelte.dev/) (SvelteKit + Vite)
- **Database**: SQLite (schema + seed data in `db/`)
- **Auth**: OTP via US phone. Dev/sandbox: `+15550000000` / `123456`, sessionStorage. Prod: Twilio + localStorage.

## Requirements

- Go 1.21+
- Node.js 18+

## Run Locally

### Production build (single server)

```bash
# 1. Seed the database
go run ./cmd/seed

# 2. Install frontend dependencies
npm install

# 3. Build the Svelte app
npm run build

# 4. Start the server
go run .
```

Open **http://localhost:8080** in your browser.

### Development (hot reload)

**Terminal 1 – Go backend**
```bash
go run ./cmd/seed   # First time only
go run .
```

**Terminal 2 – Svelte dev server**
```bash
npm install
npm run dev
```

- **App**: http://localhost:5173
- **API**: http://localhost:8080

### Using the Makefile

```bash
make seed
make build
./triangle_travel
```

## API

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/api/search` | Triangle travel search |
| GET | `/api/cities` | List city codes |
| POST | `/api/chat` | AI chat (placeholder) |
| POST | `/api/auth/send-otp` | Send OTP to US phone |
| POST | `/api/auth/verify-otp` | Verify OTP, get token |
| GET | `/api/flights` | List user's flights (auth) |
| POST | `/api/flights` | Add flight (auth) |
| DELETE | `/api/flights/:id` | Delete flight (auth) |

## Project Structure

```
triangle_travel/
├── main.go                 # Entry point
├── cmd/seed/               # DB seed from SQL
├── internal/
│   ├── api/                # Gin handlers (search, chat, auth, flights)
│   ├── auth/               # OTP, tokens
│   ├── db/                 # SQLite access
│   ├── flights/            # Triangle travel logic
│   ├── helpers/            # Utilities
│   └── server/             # HTTP server
├── db/
│   ├── schema.sql          # SQLite schema
│   ├── schema_auth.sql     # Users, sessions, flights
│   ├── seed_data.sql       # Embedded seed data
│   └── data.sqlite3        # (generated by seed)
├── src/                    # Svelte frontend
│   ├── routes/
│   │   ├── triangle-travel/
│   │   ├── chat/
│   │   └── my-flights/
│   └── lib/auth.ts         # Client auth helpers
├── build/                  # (generated by npm run build)
├── package.json
├── go.mod
└── Makefile
```

## Docker

```bash
docker build -t travel-app .
docker run -p 8080:8080 travel-app
```

The image seeds the database at build time and serves the app at http://localhost:8080.

## CI

GitHub Actions runs on push/PR to `main`/`master`: build (Go + Svelte), lint (`svelte-check`), and tests.
